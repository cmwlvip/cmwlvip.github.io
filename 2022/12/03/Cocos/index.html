<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Cocos | Ofra Serendipity</title><meta name="author" content="Shiqing Huang"><meta name="copyright" content="Shiqing Huang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="cocos游戏开发">
<meta property="og:type" content="article">
<meta property="og:title" content="Cocos">
<meta property="og:url" content="https://cmwlvip.github.io/2022/12/03/Cocos/index.html">
<meta property="og:site_name" content="Ofra Serendipity">
<meta property="og:description" content="cocos游戏开发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cmwlvip.github.io/2022/12/03/Cocos/cocos.jpg">
<meta property="article:published_time" content="2022-12-03T14:46:46.000Z">
<meta property="article:modified_time" content="2023-01-07T16:00:00.000Z">
<meta property="article:author" content="Shiqing Huang">
<meta property="article:tag" content="cocos">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cmwlvip.github.io/2022/12/03/Cocos/cocos.jpg"><link rel="shortcut icon" href="/img/favicon01.png"><link rel="canonical" href="https://cmwlvip.github.io/2022/12/03/Cocos/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Shiqing Huang","link":"链接: ","source":"来源: Ofra Serendipity","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Cocos',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-08 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="/img/avatar001.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heart-pulse"></i><span> Fun</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book-open"></i><span> Book</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fab fa-steam"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.imgdb.cn/item/638b68b716f2c2beb14d07d1.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ofra Serendipity</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heart-pulse"></i><span> Fun</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book-open"></i><span> Book</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fab fa-steam"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Cocos</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-03T14:46:46.000Z" title="发表于 2022-12-03 22:46:46">2022-12-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-07T16:00:00.000Z" title="更新于 2023-01-08 00:00:00">2023-01-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cocos/">cocos</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>39分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Cocos"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="note info modern"><p>这里使用的是2.4.9版本,使用的脚本语言为TS</p>
</div>
<h2 id="使用Cocos-Creator"><a href="#使用Cocos-Creator" class="headerlink" title="使用Cocos Creator"></a>使用Cocos Creator</h2><h3 id="新建脚本模板"><a href="#新建脚本模板" class="headerlink" title="新建脚本模板"></a>新建脚本模板</h3><p>下载好Cocos Creator新建脚本如下<br><img src="/img/loading.gif" data-original="/2022/12/03/Cocos/2022-12-03-23-55-15.png" alt="NewScript"></p>
<p>如若想更改，可修改<code>CocosDashboard_1.2.2(Cocos Creator安装路径下)\resources\.editors\Creator\2.4.9\resources\static\template\new-script.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">NewClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="comment">//@property</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// LIFE-CYCLE CALLBACKS:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// onLoad () &#123;&#125;</span></span><br><span class="line"></span><br><span class="line">    start () &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update (dt) &#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Cocos项目"><a href="#Cocos项目" class="headerlink" title="Cocos项目"></a>Cocos项目</h3><figure class="highlight plaintext"><figcaption><span>Cocos项目常用目录结构</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">——assets</span><br><span class="line">    ——audio</span><br><span class="line">    ——prefab</span><br><span class="line">    ——scene</span><br><span class="line">    ——script</span><br><span class="line">    ——texture</span><br></pre></td></tr></table></figure>
<h3 id="关于-TS下-Cocos使用"><a href="#关于-TS下-Cocos使用" class="headerlink" title="关于(TS下)Cocos使用"></a>关于(TS下)Cocos使用</h3><h4 id="报错：无法重新声明块范围变量"><a href="#报错：无法重新声明块范围变量" class="headerlink" title="报错：无法重新声明块范围变量"></a>报错：无法重新声明块范围变量</h4><p><code>let</code>声明过的变量无法再用<code>let</code>或<code>var</code>重新声明，全用<code>var</code>不会报错<br><img src="/img/loading.gif" data-original="/2022/12/03/Cocos/2022-12-04-20-04-26.png" alt="无法再用`let`重新声明"><br><img src="/img/loading.gif" data-original="/2022/12/03/Cocos/2022-12-04-20-06-14.png" alt="无法再用`let`重新声明"><br><img src="/img/loading.gif" data-original="/2022/12/03/Cocos/2022-12-04-20-07-56.png" alt="全用`var`不会报错"></p>
<h4 id="二维数组使用中错误"><a href="#二维数组使用中错误" class="headerlink" title="二维数组使用中错误"></a>二维数组使用中错误</h4><p>ERROR: Uncaught TypeError: Cannot set property ‘0’ of undefined,</p>
<p><strong>错误</strong>使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">18</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;<span class="number">18</span>;j++)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">arr</span>[i][j]=<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="hide-block"><button type="button" class="hide-button" style>正确使用
    </button><div class="hide-content"><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">18</span>;i++)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>[i]=[]</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;<span class="number">18</span>;j++)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">arr</span>[i][j]=<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>
<h2 id="Cocos脚本开发"><a href="#Cocos脚本开发" class="headerlink" title="Cocos脚本开发"></a>Cocos脚本开发</h2><h3 id="TS补充"><a href="#TS补充" class="headerlink" title="TS补充"></a>TS补充</h3><h4 id="取整"><a href="#取整" class="headerlink" title="取整"></a>取整</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//向上取整数(小数舍去,正数部分+1)</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="number">1.111</span>));<span class="comment">//=2</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="number">1.6666</span>));<span class="comment">//=2</span></span><br><span class="line"><span class="comment">//向下取整数(小数直接舍去)</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">1.111</span>));<span class="comment">//=1</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">1.666</span>));<span class="comment">//=1</span></span><br><span class="line"><span class="comment">//四舍五入</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="number">1.111</span>));<span class="comment">//1</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="number">1.666</span>));<span class="comment">//2</span></span><br><span class="line"><span class="comment">//保留小数</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="number">1.1111</span>.<span class="title function_">toFixed</span>());<span class="comment">//1</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="number">1.1111</span>.<span class="title function_">toFixed</span>(<span class="number">2</span>));<span class="comment">//1.11</span></span><br><span class="line">cc.<span class="title function_">log</span>(<span class="number">1.1111</span>.<span class="title function_">toFixed</span>(<span class="number">3</span>));<span class="comment">//1.111</span></span><br></pre></td></tr></table></figure>
<h4 id="绝对值"><a href="#绝对值" class="headerlink" title="绝对值"></a>绝对值</h4><div class="note info modern"><p><strong>(method) Math.abs(x: number): number</strong></p>
</div>
<h4 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h4><div class="note info modern"><p><strong>(method) cc.Component.schedule(callback: Function, interval?: number, repeat?: number, delay?: number): void</strong><br>!#en Schedules a custom selector. If the selector is already scheduled, then the interval parameter will be updated without scheduling it again. !#zh 调度一个自定义的回调函数。 如果回调函数已调度，那么将不会重复调度它，只会更新时间间隔参数。<br>@param callback — The callback function<br>@param interval — Tick interval in seconds. 0 means tick every frame.<br>@param repeat — The selector will be executed (repeat + 1) times, you can use cc.macro.REPEAT_FOREVER for tick infinitely.<br>@param delay — The amount of time that the first tick will wait before execution. Unit: s</p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timeCallback = <span class="keyword">function</span> (<span class="params">dt</span>) &#123;</span><br><span class="line">    cc.<span class="title function_">log</span>(<span class="string">&quot;time: &quot;</span> + dt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">schedule</span>(timeCallback, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<div class="note info modern"><p><strong>(method) cc.Component.scheduleOnce(callback: Function, delay?: number): void</strong><br>!#en Schedules a callback function that runs only once, with a delay of 0 or larger. !#zh 调度一个只运行一次的回调函数，可以指定 0 让回调函数在下一帧立即执行或者在一定的延时之后执行。<br>@param callback — A function wrapped as a selector<br>@param delay — The amount of time that the first tick will wait before execution. Unit: s</p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timeCallback = <span class="keyword">function</span> (<span class="params">dt</span>) &#123;</span><br><span class="line">  cc.<span class="title function_">log</span>(<span class="string">&quot;time: &quot;</span> + dt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">scheduleOnce</span>(timeCallback, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<div class="note info modern"><p><strong>(method) cc.Component.unscheduleAllCallbacks(): void</strong><br>!#en unschedule all scheduled callback functions: custom callback functions, and the ‘update’ callback function. Actions are not affected by this method. !#zh 取消调度所有已调度的回调函数：定制的回调函数以及 update 回调函数。动作不受此方法影响。</p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">unscheduleAllCallbacks</span>();</span><br></pre></td></tr></table></figure>
<h4 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout()"></a>setTimeout()</h4><div class="note info modern"><p><strong>function setTimeout(handler: TimerHandler, timeout?: number, …arguments: any[]): number</strong></p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        tip.<span class="title function_">destroy</span>()</span><br><span class="line">        &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="number">500</span>)</span><br></pre></td></tr></table></figure>
<h3 id="常用代码块-代码组件化"><a href="#常用代码块-代码组件化" class="headerlink" title="常用代码块(代码组件化)"></a>常用代码块(代码组件化)</h3><h4 id="随机颜色"><a href="#随机颜色" class="headerlink" title="随机颜色"></a>随机颜色</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">randomColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> red=<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span></span><br><span class="line">    <span class="keyword">let</span> green =<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span></span><br><span class="line">    <span class="keyword">let</span> blue =<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span></span><br><span class="line">    <span class="keyword">let</span> color=cc.<span class="title function_">color</span>(red,green,blue)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">color</span>=color</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="挂载资源"><a href="#挂载资源" class="headerlink" title="挂载资源"></a>挂载资源</h3><p><code>@property()</code></p>
<figure class="highlight ts"><figcaption><span>示例</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用于number型变量</span></span><br><span class="line"><span class="meta">@property</span>(cc.<span class="property">Integer</span>)</span><br><span class="line"><span class="attr">num</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//字符串</span></span><br><span class="line"><span class="meta">@property</span>(cc.<span class="property">String</span>)</span><br><span class="line"><span class="attr">text</span>: <span class="built_in">string</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="comment">//Boolean</span></span><br><span class="line"><span class="meta">@property</span>(cc.<span class="property">Boolean</span>)</span><br><span class="line"><span class="attr">isTrue</span>:<span class="built_in">boolean</span>=<span class="literal">false</span>;</span><br><span class="line"><span class="comment">//图片数组</span></span><br><span class="line"><span class="meta">@property</span>(cc.<span class="property">SpriteFrame</span>)</span><br><span class="line"><span class="attr">picArr</span>:cc.<span class="property">SpriteFrame</span>[]=[];</span><br></pre></td></tr></table></figure>
<h4 id="挂载Cocos类"><a href="#挂载Cocos类" class="headerlink" title="挂载Cocos类"></a>挂载Cocos类</h4><p>有两种写法，效果是一样的</p>
<div class="tabs" id="property"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#property-1">直接写在&#64;property()</button></li><li class="tab active"><button type="button" data-href="#property-2">const法</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="property-1"><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>:cc.<span class="title class_">Class</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;pic_List&quot;</span>,</span><br><span class="line">        <span class="attr">properties</span>:&#123;</span><br><span class="line">            <span class="attr">a</span>:&#123;</span><br><span class="line">                <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">                <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">b</span>:&#123;</span><br><span class="line">                <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">                <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">c</span>:&#123;</span><br><span class="line">                <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">                <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">displayName</span>:<span class="string">&quot;图片数组&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">pic_List=<span class="literal">null</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="property-2"><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> picArr=cc.<span class="title class_">Class</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;pic_List&quot;</span>,</span><br><span class="line">    <span class="attr">properties</span>:&#123;</span><br><span class="line">        <span class="attr">a</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">b</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">c</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">    <span class="meta">@property</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>:picArr,</span><br><span class="line">        <span class="attr">displayName</span>:<span class="string">&quot;图片数组&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    pic_List=<span class="literal">null</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><h4 id="获取组件"><a href="#获取组件" class="headerlink" title="获取组件"></a>获取组件</h4><div class="note info modern"><p><strong>(method) cc._BaseNode.getComponent&lt;cc.Component&gt;(type: {<br>    prototype: cc.Component;<br>}): cc.Component (+1 overload)</strong><br>!#en Returns the component of supplied type if the node has one attached, null if it doesn’t. You can also get component in the node by passing in the name of the script. !#zh 获取节点上指定类型的组件，如果节点有附加指定类型的组件，则返回，如果没有则为空。 传入参数也可以是脚本的名称。<br>@param typeOrClassName — typeOrClassName</p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get sprite component</span></span><br><span class="line"><span class="keyword">let</span> sprite = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>);</span><br><span class="line"><span class="comment">// get custom test class</span></span><br><span class="line"><span class="keyword">let</span> test = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(<span class="string">&quot;Test&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="预制体"><a href="#预制体" class="headerlink" title="预制体"></a>预制体</h3><p>克隆指定的任意类型的对象，或者从 Prefab 实例化出新节点</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span>(cc.<span class="property">Prefab</span>)</span><br><span class="line"><span class="attr">prefabAsset</span>:cc.<span class="property">Prefab</span>=<span class="literal">null</span>;</span><br><span class="line">onLoad () &#123;</span><br><span class="line">    <span class="comment">// instantiate node from prefab</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">scene</span>:cc.<span class="property">Scene</span>=cc.<span class="property">director</span>.<span class="title function_">getScene</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">node</span>:cc.<span class="property">Node</span>=cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">prefabAsset</span>);</span><br><span class="line">    node.<span class="property">parent</span> = scene;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span>(cc.<span class="property">Node</span>)</span><br><span class="line"><span class="attr">targetNode</span>:cc.<span class="property">Node</span>=<span class="literal">null</span>;</span><br><span class="line">onLoad () &#123;</span><br><span class="line">    <span class="comment">// clone node</span></span><br><span class="line">    <span class="keyword">let</span> scene = cc.<span class="property">director</span>.<span class="title function_">getScene</span>();</span><br><span class="line">    <span class="keyword">let</span> node = cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">targetNode</span>);</span><br><span class="line">    node.<span class="property">parent</span> = scene;</span><br><span class="line">    node.<span class="title function_">setPosition</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><h4 id="切换场景"><a href="#切换场景" class="headerlink" title="切换场景"></a>切换场景</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc.<span class="property">director</span>.<span class="title function_">loadScene</span>(<span class="string">&quot;game&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="节点-cc-Node"><a href="#节点-cc-Node" class="headerlink" title="节点(cc.Node)"></a>节点(cc.Node)</h3><h4 id="新结点"><a href="#新结点" class="headerlink" title="新结点"></a>新结点</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">bullet</span>:cc.<span class="property">Node</span>=<span class="keyword">new</span> cc.<span class="title class_">Node</span>()</span><br></pre></td></tr></table></figure>
<h4 id="寻找节点"><a href="#寻找节点" class="headerlink" title="寻找节点"></a>寻找节点</h4><p><code>cc.find()</code><br><div class="note info modern"><p><strong>function cc.find(path: string, referenceNode?: cc.Node): cc.Node</strong><br>Finds a node by hierarchy path, the path is case-sensitive. It will traverse the hierarchy by splitting the path using ‘/‘ character. This function will still returns the node even if it is inactive. It is recommended to not use this function every frame instead cache the result at startup.<br>@param path — path<br>@param referenceNode — referenceNode</p>
</div></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc.<span class="title function_">find</span>(<span class="string">&quot;Canvas/startButton/Background/start&quot;</span>).<span class="title function_">getComponent</span>(cc.<span class="property">Label</span>).<span class="property">string</span>=<span class="string">&quot;重新开始&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>getChildByName(&quot;name&quot;)</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getChildByName</span>(<span class="string">&quot;Background&quot;</span>).<span class="title function_">getChildByName</span>(<span class="string">&quot;start&quot;</span>).<span class="title function_">getComponent</span>(cc.<span class="property">Label</span>).<span class="property">string</span>=<span class="string">&quot;重新开始&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="节点层次"><a href="#节点层次" class="headerlink" title="节点层次"></a>节点层次</h4><p>拥有更高 <code>zIndex</code> 的节点将被排在后面</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">playagain</span> = cc.<span class="title function_">find</span>(<span class="string">&quot;main/start&quot;</span>, <span class="variable language_">this</span>.<span class="property">node</span>);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">playagain</span>.<span class="property">zIndex</span> = <span class="number">100</span>;<span class="comment">//拥有更高 zIndex 的节点将被排在后面</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">playagain</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
<h3 id="坐标与距离"><a href="#坐标与距离" class="headerlink" title="坐标与距离"></a>坐标与距离</h3><h4 id="全局坐标转相对坐标"><a href="#全局坐标转相对坐标" class="headerlink" title="全局坐标转相对坐标"></a>全局坐标转相对坐标</h4><div class="note info modern"><p><strong>(method) cc.Node.convertToNodeSpaceAR&lt;cc.Vec2&gt;(worldPoint: cc.Vec2, out?: cc.Vec2): cc.Vec2</strong><br>!#en Converts a Point to node (local) space coordinates. !#zh 将一个点转换到节点 (局部) 空间坐标系。<br>@param worldPoint — worldPoint<br>@param out — out</p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> temp_position=<span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">convertToNodeSpaceAR</span>(<span class="title class_">Point</span>)</span><br></pre></td></tr></table></figure>
<h4 id="向量减法"><a href="#向量减法" class="headerlink" title="向量减法"></a>向量减法</h4><div class="note info modern"><p><strong>(method) cc.Vec2.sub(vector: cc.Vec2, out?: cc.Vec2): cc.Vec2</strong><br>!#en Subtracts one vector from this, and returns the new result. !#zh 向量减法，并返回新结果。<br>@param vector — vector<br>@param out — optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created</p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v :cc.<span class="property">Vec2</span>= cc.<span class="title function_">v2</span>(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">v.<span class="title function_">sub</span>(cc.<span class="title function_">v2</span>(<span class="number">5</span>, <span class="number">5</span>));      <span class="comment">// return Vec2 &#123;x: 5, y: 5&#125;;</span></span><br><span class="line"><span class="keyword">let</span> v1 = <span class="keyword">new</span> cc.<span class="title class_">Vec2</span>();</span><br><span class="line">v.<span class="title function_">sub</span>(cc.<span class="title function_">v2</span>(<span class="number">5</span>, <span class="number">5</span>), v1);  <span class="comment">// return Vec2 &#123;x: 5, y: 5&#125;;结果放于v1</span></span><br></pre></td></tr></table></figure>
<h4 id="向量长度"><a href="#向量长度" class="headerlink" title="向量长度"></a>向量长度</h4><div class="note info modern"><p><strong>(method) cc.Vec2.mag(): number</strong><br>!#en Returns the length of this vector. !#zh 返回该向量的长度。</p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v = cc.<span class="title function_">v2</span>(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">v.<span class="title function_">mag</span>(); <span class="comment">// return 14.142135623730951;</span></span><br></pre></td></tr></table></figure>
<h3 id="鼠标事件"><a href="#鼠标事件" class="headerlink" title="鼠标事件"></a>鼠标事件</h3><p>可以使用枚举类型也可以直接使用事件名来注册事件的监听器</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>枚举对象定义</th>
<th>对应的事件名</th>
<th>事件触发的时机</th>
</tr>
</thead>
<tbody>
<tr>
<td>cc.Node.EventType.MOUSE_DOWN</td>
<td><code>mousedown</code></td>
<td>当鼠标在目标节点区域按下时触发一次</td>
</tr>
<tr>
<td>cc.Node.EventType.MOUSE_ENTER</td>
<td><code>mouseenter</code></td>
<td>当鼠标移入目标节点区域时，不论是否按下</td>
</tr>
<tr>
<td>cc.Node.EventType.MOUSE_MOVE</td>
<td><code>mousemove</code></td>
<td>当鼠标在目标节点区域中移动时，不论是否按下</td>
</tr>
<tr>
<td>cc.Node.EventType.MOUSE_LEAVE</td>
<td><code>mouseleave</code></td>
<td>当鼠标移出目标节点区域时，不论是否按下</td>
</tr>
<tr>
<td>cc.Node.EventType.MOUSE_UP</td>
<td><code>mouseup</code></td>
<td>当鼠标从按下状态松开时触发一次</td>
</tr>
<tr>
<td>cc.Node.EventType.MOUSE_WHEEL</td>
<td><code>mousewheel</code></td>
<td>当鼠标滚轮滚动时</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight ts"><figcaption><span>注册事件示例</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="string">&#x27;mousedown&#x27;</span>,<span class="variable language_">this</span>.<span class="property">playGame</span>,<span class="variable language_">this</span>)</span><br><span class="line"><span class="title function_">playGame</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Mouse down&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常用API</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>函数名</th>
<th>返回值类型</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getScrollY</code></td>
<td>Number</td>
<td>获取滚轮滚动的 Y 轴距离，只有<strong>滚动时才有效</strong></td>
</tr>
<tr>
<td><code>getLocation</code></td>
<td>Object</td>
<td>获取鼠标位置对象，对象包含 x 和 y 属性</td>
</tr>
<tr>
<td><code>getPreviousLocation</code></td>
<td>Object</td>
<td>获取鼠标事件上次触发时的位置对象，对象包含 x 和 y 属性</td>
</tr>
<tr>
<td><code>getDelta</code></td>
<td>Object</td>
<td>获取鼠标距离上一次事件移动的距离对象，对象包含 x 和 y 属性</td>
</tr>
</tbody>
</table>
</div>
<h3 id="触摸事件"><a href="#触摸事件" class="headerlink" title="触摸事件"></a>触摸事件</h3><div class="table-container">
<table>
<thead>
<tr>
<th>枚举对象定义</th>
<th>对应的事件名</th>
<th>事件触发的时机</th>
</tr>
</thead>
<tbody>
<tr>
<td>cc.Node.EventType.TOUCH_START</td>
<td><code>touchstart</code></td>
<td>当手指触点落在目标节点区域内时</td>
</tr>
<tr>
<td>cc.Node.EventType.TOUCH_MOVE</td>
<td><code>touchmove</code></td>
<td>当手指在屏幕上移动时</td>
</tr>
<tr>
<td>cc.Node.EventType.TOUCH_END</td>
<td><code>touchend</code></td>
<td>当手指在目标节点区域内离开屏幕时</td>
</tr>
<tr>
<td>cc.Node.EventType.TOUCH_CANCEL</td>
<td><code>touchcancel</code></td>
<td>当手指在目标节点区域外离开屏幕时</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight ts"><figcaption><span>示例</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="string">&#x27;touchstart&#x27;</span>,<span class="variable language_">this</span>.<span class="property">playGame</span>,<span class="variable language_">this</span>)</span><br><span class="line"><span class="title function_">playGame</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;touch start&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常用API</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>函数名</th>
<th>返回值类型</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>touch</code></td>
<td>cc.Touch</td>
<td>与当前事件关联的触点对象</td>
</tr>
<tr>
<td><code>getID</code></td>
<td>Number</td>
<td>获取触点的 ID，用于多点触摸的逻辑判断</td>
</tr>
<tr>
<td><code>getLocation</code></td>
<td>Object</td>
<td>获取触点位置对象，对象包含 x 和 y 属性</td>
</tr>
<tr>
<td><code>getPreviousLocation</code></td>
<td>Object</td>
<td>获取触点上一次触发事件时的位置对象，对象包含 x 和 y 属性</td>
</tr>
<tr>
<td><code>getStartLocation</code></td>
<td>Object</td>
<td>获取触点距离上一次事件移动的距离对象，对象包含 x 和 y 属性</td>
</tr>
<tr>
<td><code>getDelta</code></td>
<td>Object</td>
<td>获取触点距离上一次事件移动的距离对象，对象包含 x 和 y 属性</td>
</tr>
</tbody>
</table>
</div>
<h3 id="声音"><a href="#声音" class="headerlink" title="声音"></a>声音</h3><h4 id="挂载资源法使用声音-cc-AudioClip"><a href="#挂载资源法使用声音-cc-AudioClip" class="headerlink" title="挂载资源法使用声音(cc.AudioClip)"></a>挂载资源法使用声音(cc.AudioClip)</h4><div class="note info modern"><p><strong>method) cc.audioEngine.playEffect(clip: cc.AudioClip, loop: boolean): number</strong><br>!#en Play effect audio. !#zh 播放音效<br>@param clip — The audio clip to play.<br>@param loop — Whether the music loop or not.</p>
</div>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span>(cc.<span class="property">AudioClip</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="attr">bgmAudio</span>:cc.<span class="property">AudioClip</span>=<span class="literal">null</span></span><br><span class="line">cc.<span class="property">audioEngine</span>.<span class="title function_">playEffect</span>(<span class="variable language_">this</span>.<span class="property">bgmAudio</span>, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>
<h4 id="组件-cc-AudioSource-法使用声音"><a href="#组件-cc-AudioSource-法使用声音" class="headerlink" title="组件(cc.AudioSource)法使用声音"></a>组件(cc.AudioSource)法使用声音</h4><p>节点下需要有这个组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">AudioSource</span>).<span class="title function_">play</span>()</span><br></pre></td></tr></table></figure>
<h2 id="碰撞系统"><a href="#碰撞系统" class="headerlink" title="碰撞系统"></a>碰撞系统</h2><h3 id="碰撞系统接口"><a href="#碰撞系统接口" class="headerlink" title="碰撞系统接口"></a>碰撞系统接口</h3><p>获取碰撞检测系统</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> manager = cc.<span class="property">director</span>.<span class="title function_">getCollisionManager</span>()</span><br></pre></td></tr></table></figure>
<p>默认碰撞检测系统是禁用的</p>
<figure class="highlight ts"><figcaption><span>开启默认碰撞检测系统</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager.<span class="property">enabled</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>默认碰撞检测系统的 <code>debug</code> 绘制是禁用的</p>
<figure class="highlight ts"><figcaption><span>开启碰撞系统绘制</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager.<span class="property">enabledDebugDraw</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><figcaption><span>显示碰撞组件的包围盒</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager.<span class="property">enabledDrawBoundingBox</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="碰撞组件"><a href="#碰撞组件" class="headerlink" title="碰撞组件"></a>碰撞组件</h3><p>碰撞组件有三种</p>
<h4 id="矩形碰撞组件-cc-BoxCollider"><a href="#矩形碰撞组件-cc-BoxCollider" class="headerlink" title="矩形碰撞组件(cc.BoxCollider)"></a>矩形碰撞组件(cc.BoxCollider)</h4><h4 id="圆形碰撞组件-cc-CircleCollider"><a href="#圆形碰撞组件-cc-CircleCollider" class="headerlink" title="圆形碰撞组件(cc.CircleCollider)"></a>圆形碰撞组件(cc.CircleCollider)</h4><h4 id="多边形碰撞组件-cc-PolygonCollider"><a href="#多边形碰撞组件-cc-PolygonCollider" class="headerlink" title="多边形碰撞组件(cc.PolygonCollider)"></a>多边形碰撞组件(cc.PolygonCollider)</h4><h3 id="碰撞系统回调"><a href="#碰撞系统回调" class="headerlink" title="碰撞系统回调"></a>碰撞系统回调</h3><p>当碰撞系统检测到有碰撞产生时，将会以回调的方式通知使用者，如果产生碰撞的碰撞组件依附的节点下挂的脚本中有实现以下函数，则会自动调用以下函数，并传入相关的参数。<br><div class="note info modern"><p>@param  {Collider} other 产生碰撞的另一个碰撞组件<br>@param  {Collider} self  产生碰撞的自身的碰撞组件</p>
</div></p>
<div class="note warning modern"><p>碰撞脚本一定要挂载在有碰撞组件的节点上</p>
</div>
<h4 id="碰撞产生的时候调用"><a href="#碰撞产生的时候调用" class="headerlink" title="碰撞产生的时候调用"></a>碰撞产生的时候调用</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onCollisionEnter</span>(<span class="params">other, self</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;on collision enter&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="碰撞中调用"><a href="#碰撞中调用" class="headerlink" title="碰撞中调用"></a>碰撞中调用</h4><p>当碰撞产生后，碰撞结束前的情况下，每次计算碰撞结果后调用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onCollisionStay</span>(<span class="params">other, self</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;on collision stay&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="碰撞结束后调用"><a href="#碰撞结束后调用" class="headerlink" title="碰撞结束后调用"></a>碰撞结束后调用</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onCollisionExit</span>(<span class="params">other, self</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;on collision exit&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="角色移动"><a href="#角色移动" class="headerlink" title="角色移动"></a>角色移动</h2><p>由于移动中，经常涉及到重复播放动画的问题，直接写在事件函数里，往往出现各种问题<br>所以，实现移动一般使用<strong>状态监听法</strong>(比如按下A键开启左移状态)</p>
<h3 id="键盘事件控制移动"><a href="#键盘事件控制移动" class="headerlink" title="键盘事件控制移动"></a>键盘事件控制移动</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">onKeyDown (<span class="attr">event</span>:cc.<span class="property">Event</span>.<span class="property">EventKeyboard</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(event.<span class="property">keyCode</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">a</span>:</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Left</span> = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">d</span>:</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Right</span> = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">onKeyUp (event) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(event.<span class="property">keyCode</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">a</span>:</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Left</span> = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">d</span>:</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Right</span> = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Left</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Right</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">xSpeed</span> = <span class="number">0</span></span><br><span class="line">    cc.<span class="property">systemEvent</span>.<span class="title function_">on</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_DOWN</span>, <span class="variable language_">this</span>.<span class="property">onKeyDown</span>, <span class="variable language_">this</span>)</span><br><span class="line">    cc.<span class="property">systemEvent</span>.<span class="title function_">on</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_UP</span>, <span class="variable language_">this</span>.<span class="property">onKeyUp</span>, <span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onDestroy</span>(<span class="params"></span>)&#123;</span><br><span class="line">    cc.<span class="property">systemEvent</span>.<span class="title function_">off</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_DOWN</span>, <span class="variable language_">this</span>.<span class="property">onKeyDown</span>, <span class="variable language_">this</span>)</span><br><span class="line">    cc.<span class="property">systemEvent</span>.<span class="title function_">off</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_UP</span>, <span class="variable language_">this</span>.<span class="property">onKeyUp</span>, <span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="加速度式移动"><a href="#加速度式移动" class="headerlink" title="加速度式移动"></a>加速度式移动</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">update</span>(<span class="params">dt</span>) &#123;</span><br><span class="line">     <span class="comment">// 根据当前加速度方向每帧更新速度</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">Left</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">xSpeed</span> -= <span class="variable language_">this</span>.<span class="property">accel</span> * dt</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">Right</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">xSpeed</span> += <span class="variable language_">this</span>.<span class="property">accel</span> * dt</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 限制角色的速度不能超过最大值</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">xSpeed</span>) &gt; <span class="variable language_">this</span>.<span class="property">maxMoveSpeed</span>) &#123;</span><br><span class="line">        <span class="comment">// if speed reach limit, use max speed with current direction</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">xSpeed</span> = <span class="variable language_">this</span>.<span class="property">maxMoveSpeed</span> * <span class="variable language_">this</span>.<span class="property">xSpeed</span> / <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">xSpeed</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//位置处理</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>&lt;-<span class="number">880</span>)&#123;</span><br><span class="line">        <span class="comment">//this.xSpeed=-this.xSpeed</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">xSpeed</span>=<span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>&gt;<span class="number">880</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">xSpeed</span>=-<span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据当前速度更新主角的位置</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">xSpeed</span> * dt</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="触摸移动"><a href="#触摸移动" class="headerlink" title="触摸移动"></a>触摸移动</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">move</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> offset = event.<span class="title function_">getDelta</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span> += offset.<span class="property">x</span>;</span><br><span class="line">    <span class="comment">//边界处理</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>&lt;-<span class="number">450</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>=-<span class="number">445</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>&gt;<span class="number">450</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>=<span class="number">445</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">onLoad () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(cc.<span class="property">Node</span>.<span class="property">EventType</span>.<span class="property">TOUCH_MOVE</span>, <span class="variable language_">this</span>.<span class="property">move</span>,<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Cocos-Project"><a href="#Cocos-Project" class="headerlink" title="Cocos Project"></a>Cocos Project</h2><h3 id="摘星星-PickStars"><a href="#摘星星-PickStars" class="headerlink" title="摘星星(PickStars)"></a>摘星星(PickStars)</h3><h4 id="PickStars"><a href="#PickStars" class="headerlink" title="PickStars"></a>PickStars</h4><p><a href="https://cmwlvip.github.io/game/PickStars/index.html">游戏预览</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">——Canvas</span><br><span class="line">    ——background</span><br><span class="line">    ——Main Camera</span><br><span class="line">    ——ground</span><br><span class="line">    ——Player</span><br><span class="line">    ——score</span><br></pre></td></tr></table></figure>
<div class="tabs" id="pickstars"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#pickstars-1">Game.ts</button></li><li class="tab"><button type="button" data-href="#pickstars-2">Star.ts</button></li><li class="tab"><button type="button" data-href="#pickstars-3">Player.ts</button></li><li class="tab"><button type="button" data-href="#pickstars-4">Start.ts</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="pickstars-1"><figure class="highlight ts"><figcaption><span>用于挂载在Canvas节点下控制游戏的进行</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  &#123;<span class="title class_">Global</span>&#125;  <span class="keyword">from</span> <span class="string">&quot;./Start&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Game</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="comment">//分数显示</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Label</span>)</span><br><span class="line">    <span class="attr">scoreDisplay</span>: cc.<span class="property">Label</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 这个属性引用了星星预制资源</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">starPrefab</span>:cc.<span class="property">Prefab</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 星星产生后消失时间的随机范围</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Integer</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">maxStarDuration</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Integer</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">minStarDuration</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 地面节点，用于确定星星生成的高度</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">groundNode</span>:cc.<span class="property">Node</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// Player 节点，用于获取主角弹跳的高度，和控制主角行动开关</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Node</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">playerNode</span>:cc.<span class="property">Node</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 得分音效资源</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">AudioClip</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">scoreAudio</span>:cc.<span class="property">AudioClip</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//地面节点的Y坐标</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">groundY</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//得分</span></span><br><span class="line">    <span class="keyword">private</span> score=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//计时器</span></span><br><span class="line">    <span class="attr">timer</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//星星消失时间</span></span><br><span class="line">    <span class="attr">starDuration</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">spawnNewStar</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 使用给定的模板在场景中生成一个新节点</span></span><br><span class="line">        <span class="keyword">let</span> <span class="attr">newStar</span>:cc.<span class="property">Node</span> = cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">starPrefab</span>)</span><br><span class="line">        <span class="comment">// 将新增的节点添加到 Canvas 节点下面</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">addChild</span>(newStar)</span><br><span class="line">        <span class="comment">// 为星星设置一个随机位置</span></span><br><span class="line">        newStar.<span class="title function_">setPosition</span>(<span class="variable language_">this</span>.<span class="title function_">getNewStarPosition</span>())</span><br><span class="line">        <span class="comment">// 在星星脚本组件上保存 Game 对象的引用</span></span><br><span class="line">        newStar.<span class="title function_">getComponent</span>(<span class="string">&#x27;Star&#x27;</span>).<span class="property">game</span> = <span class="variable language_">this</span></span><br><span class="line">        <span class="comment">// 重置计时器，根据消失时间范围随机取一个值</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">starDuration</span> = <span class="variable language_">this</span>.<span class="property">minStarDuration</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * (<span class="variable language_">this</span>.<span class="property">maxStarDuration</span> - <span class="variable language_">this</span>.<span class="property">minStarDuration</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getNewStarPosition</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">randX</span>:<span class="built_in">number</span>= <span class="number">0</span></span><br><span class="line">        <span class="comment">// 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标</span></span><br><span class="line">        <span class="keyword">let</span> randY = <span class="variable language_">this</span>.<span class="property">groundY</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable language_">this</span>.<span class="property">playerNode</span>.<span class="title function_">getComponent</span>(<span class="string">&#x27;Player&#x27;</span>).<span class="property">jumpHeight</span> + <span class="number">70</span></span><br><span class="line">        <span class="comment">// 根据屏幕宽度，随机得到一个星星 x 坐标</span></span><br><span class="line">        <span class="keyword">let</span> maxX = <span class="number">888</span></span><br><span class="line">        randX = (<span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>) * <span class="number">2</span> * maxX</span><br><span class="line">        <span class="comment">// 返回星星坐标</span></span><br><span class="line">        <span class="keyword">return</span> cc.<span class="title function_">v2</span>(randX, randY)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">gainScore</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">score</span> += <span class="number">1</span></span><br><span class="line">        <span class="comment">// 更新 scoreDisplay Label 的文字</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scoreDisplay</span>.<span class="property">string</span> = <span class="string">&#x27;Score: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">score</span></span><br><span class="line">        <span class="comment">// 播放得分音效</span></span><br><span class="line">        cc.<span class="property">audioEngine</span>.<span class="title function_">playEffect</span>(<span class="variable language_">this</span>.<span class="property">scoreAudio</span>, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">gameOver</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 停止 Player 节点的跳跃动作</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerNode</span>.<span class="title function_">stopAllActions</span>()</span><br><span class="line">        <span class="comment">// let sence=cc.director.getScene()</span></span><br><span class="line">        <span class="comment">// cc.log(sence)</span></span><br><span class="line">        <span class="comment">// 重新加载场景 play</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>()</span><br><span class="line">        cc.<span class="property">director</span>.<span class="title function_">loadScene</span>(<span class="string">&#x27;play&#x27;</span>)</span><br><span class="line">        <span class="title class_">Global</span>.<span class="property">isRestart</span>=<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">touchStart</span>(<span class="params">event</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">x</span>:<span class="built_in">number</span>=event.<span class="title function_">getLocationX</span>()</span><br><span class="line">        <span class="keyword">if</span>(x&lt;=<span class="number">960</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">playerNode</span>.<span class="title function_">getComponent</span>(<span class="string">&quot;Player&quot;</span>).<span class="property">accLeft</span>=<span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">playerNode</span>.<span class="title function_">getComponent</span>(<span class="string">&quot;Player&quot;</span>).<span class="property">accRight</span>=<span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">touchEnd</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerNode</span>.<span class="title function_">getComponent</span>(<span class="string">&quot;Player&quot;</span>).<span class="property">accLeft</span>=<span class="literal">false</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerNode</span>.<span class="title function_">getComponent</span>(<span class="string">&quot;Player&quot;</span>).<span class="property">accRight</span>=<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    onLoad () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="string">&quot;touchstart&quot;</span>,<span class="variable language_">this</span>.<span class="property">touchStart</span>,<span class="variable language_">this</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="string">&quot;touchend&quot;</span>,<span class="variable language_">this</span>.<span class="property">touchEnd</span>,<span class="variable language_">this</span>)</span><br><span class="line">        cc.<span class="property">macro</span>.<span class="property">ENABLE_MULTI_TOUCH</span> = <span class="literal">false</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">score</span> = <span class="number">0</span></span><br><span class="line">        <span class="comment">// 初始化计时器</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">starDuration</span> = <span class="number">0</span></span><br><span class="line">        <span class="comment">// 获取地平面的 y 轴坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">groundY</span> = <span class="variable language_">this</span>.<span class="property">groundNode</span>.<span class="property">y</span> + <span class="variable language_">this</span>.<span class="property">groundNode</span>.<span class="property">height</span>/<span class="number">2</span></span><br><span class="line">        <span class="comment">// 生成一个新的星星</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">spawnNewStar</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    start () &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    update (dt) &#123;</span><br><span class="line">        <span class="comment">// 每帧更新计时器，超过限度还没有生成新的星星</span></span><br><span class="line">        <span class="comment">// 就会调用游戏失败逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">timer</span> &gt; <span class="variable language_">this</span>.<span class="property">starDuration</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">gameOver</span>()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timer</span> += dt</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="pickstars-2"><p>这里使用了其他脚本的函数</p>
<figure class="highlight ts"><figcaption><span>挂载于星星预制体</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Game</span> <span class="keyword">from</span><span class="string">&quot;./Game&quot;</span></span><br><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Star</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="comment">//收集距离</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Integer</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pickRadius</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">game</span>:<span class="title class_">Game</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">init</span>(<span class="params">game:Game</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">game</span>=game</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getPlayerDistance</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 根据 Player 节点位置判断距离</span></span><br><span class="line">        <span class="keyword">let</span> playerPos = <span class="variable language_">this</span>.<span class="property">game</span>.<span class="property">playerNode</span>.<span class="title function_">getPosition</span>()</span><br><span class="line">        <span class="comment">// 根据两点位置计算两点之间距离</span></span><br><span class="line">        <span class="keyword">let</span> dist = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getPosition</span>().<span class="title function_">sub</span>(playerPos).<span class="title function_">mag</span>()</span><br><span class="line">        <span class="keyword">return</span> dist</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onPicked</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 当星星被收集时，调用 Game 脚本中的接口，生成一个新的星星</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">game</span>.<span class="title function_">spawnNewStar</span>()</span><br><span class="line">        <span class="comment">// 调用 Game 脚本的得分方法</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">game</span>.<span class="title function_">gainScore</span>()</span><br><span class="line">        <span class="comment">// 然后销毁当前星星节点</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    onLoad () &#123;&#125;</span><br><span class="line">    start () &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    update (dt) &#123;</span><br><span class="line">         <span class="comment">// 每帧判断星星和主角之间的距离是否小于收集距离</span></span><br><span class="line">         <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">getPlayerDistance</span>() &lt; <span class="variable language_">this</span>.<span class="property">pickRadius</span>) &#123;</span><br><span class="line">            <span class="comment">// 调用收集行为</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">onPicked</span>()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据 Game 脚本中的计时器更新星星的透明度</span></span><br><span class="line">        <span class="keyword">let</span> opacityRatio = <span class="number">1</span> - <span class="variable language_">this</span>.<span class="property">game</span>.<span class="property">timer</span>/<span class="variable language_">this</span>.<span class="property">game</span>.<span class="property">starDuration</span>;</span><br><span class="line">        <span class="keyword">let</span> minOpacity = <span class="number">50</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">opacity</span> = minOpacity + <span class="title class_">Math</span>.<span class="title function_">floor</span>(opacityRatio * (<span class="number">255</span> - minOpacity))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="pickstars-3"><figure class="highlight ts"><figcaption><span>用于实现角色控制</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Player</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">     <span class="comment">// 主角跳跃高度</span></span><br><span class="line">     <span class="meta">@property</span>(cc.<span class="property">Integer</span>)</span><br><span class="line">     <span class="keyword">private</span> <span class="attr">jumpHeight</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">     <span class="comment">// 主角跳跃持续时间</span></span><br><span class="line">     <span class="meta">@property</span>(cc.<span class="property">Integer</span>)</span><br><span class="line">     <span class="keyword">private</span> <span class="attr">jumpDuration</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">     <span class="comment">// 最大移动速度</span></span><br><span class="line">     <span class="meta">@property</span>(cc.<span class="property">Integer</span>)</span><br><span class="line">     <span class="keyword">private</span> <span class="attr">maxMoveSpeed</span>:<span class="built_in">number</span>= <span class="number">0</span>;</span><br><span class="line">     <span class="comment">// 加速度</span></span><br><span class="line">     <span class="meta">@property</span>(cc.<span class="property">Integer</span>)</span><br><span class="line">     <span class="keyword">private</span> <span class="attr">accel</span>:<span class="built_in">number</span>= <span class="number">0</span>;</span><br><span class="line">     <span class="meta">@property</span>(cc.<span class="property">AudioClip</span>)</span><br><span class="line">     <span class="keyword">private</span> <span class="attr">jumpAudio</span>:cc.<span class="property">AudioClip</span>=<span class="literal">null</span>;</span><br><span class="line">     <span class="comment">//速度</span></span><br><span class="line">     <span class="keyword">private</span> <span class="attr">xSpeed</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">     <span class="keyword">private</span> <span class="attr">accLeft</span>:<span class="built_in">boolean</span>=<span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">private</span> <span class="attr">accRight</span>:<span class="built_in">boolean</span>=<span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">private</span> <span class="title function_">setJumpAction</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 跳跃上升</span></span><br><span class="line">        <span class="keyword">let</span> jumpUp = cc.<span class="title function_">tween</span>().<span class="title function_">by</span>(<span class="variable language_">this</span>.<span class="property">jumpDuration</span>, &#123;<span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">jumpHeight</span>&#125;, &#123;<span class="attr">easing</span>: <span class="string">&#x27;sineOut&#x27;</span>&#125;)</span><br><span class="line">        <span class="comment">// 下落</span></span><br><span class="line">        <span class="keyword">let</span> jumpDown = cc.<span class="title function_">tween</span>().<span class="title function_">by</span>(<span class="variable language_">this</span>.<span class="property">jumpDuration</span>, &#123;<span class="attr">y</span>: -<span class="variable language_">this</span>.<span class="property">jumpHeight</span>&#125;, &#123;<span class="attr">easing</span>: <span class="string">&#x27;sineIn&#x27;</span>&#125;)</span><br><span class="line">        <span class="comment">// 创建一个缓动，按 jumpUp、jumpDown 的顺序执行动作</span></span><br><span class="line">        <span class="keyword">let</span> tween = cc.<span class="title function_">tween</span>()</span><br><span class="line">        .<span class="title function_">sequence</span>(jumpUp, jumpDown)</span><br><span class="line">        <span class="comment">// 添加一个回调函数，在前面的动作都结束时调用我们定义的 playJumpSound() 方法</span></span><br><span class="line">        .<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">playJumpSound</span>, <span class="variable language_">this</span>)</span><br><span class="line">        <span class="comment">// 不断重复</span></span><br><span class="line">        <span class="keyword">return</span> cc.<span class="title function_">tween</span>().<span class="title function_">repeatForever</span>(tween)</span><br><span class="line">    &#125;</span><br><span class="line">    onKeyDown (<span class="attr">event</span>:cc.<span class="property">Event</span>.<span class="property">EventKeyboard</span>) &#123;</span><br><span class="line">        <span class="comment">// set a flag when key pressed</span></span><br><span class="line">        <span class="keyword">switch</span>(event.<span class="property">keyCode</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">a</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">accLeft</span> = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">d</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">accRight</span> = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    onKeyUp (event) &#123;</span><br><span class="line">        <span class="comment">// unset a flag when key released</span></span><br><span class="line">        <span class="keyword">switch</span>(event.<span class="property">keyCode</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">a</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">accLeft</span> = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">d</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">accRight</span> = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">playJumpSound</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 调用声音引擎播放声音</span></span><br><span class="line">        cc.<span class="property">audioEngine</span>.<span class="title function_">playEffect</span>(<span class="variable language_">this</span>.<span class="property">jumpAudio</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> jumpAction = <span class="variable language_">this</span>.<span class="title function_">setJumpAction</span>()</span><br><span class="line">        cc.<span class="title function_">tween</span>(<span class="variable language_">this</span>.<span class="property">node</span>).<span class="title function_">then</span>(jumpAction).<span class="title function_">start</span>()</span><br><span class="line">        <span class="comment">// 加速度方向开关</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">accLeft</span> = <span class="literal">false</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">accRight</span> = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// 主角当前水平方向速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">xSpeed</span> = <span class="number">0</span></span><br><span class="line">        <span class="comment">// 初始化键盘输入监听</span></span><br><span class="line">        cc.<span class="property">systemEvent</span>.<span class="title function_">on</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_DOWN</span>, <span class="variable language_">this</span>.<span class="property">onKeyDown</span>, <span class="variable language_">this</span>)</span><br><span class="line">        cc.<span class="property">systemEvent</span>.<span class="title function_">on</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_UP</span>, <span class="variable language_">this</span>.<span class="property">onKeyUp</span>, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    start () &#123;&#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params">dt</span>) &#123;</span><br><span class="line">        <span class="comment">// 根据当前加速度方向每帧更新速度</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">accLeft</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">xSpeed</span> -= <span class="variable language_">this</span>.<span class="property">accel</span> * dt</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">accRight</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">xSpeed</span> += <span class="variable language_">this</span>.<span class="property">accel</span> * dt</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 限制主角的速度不能超过最大值</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">xSpeed</span>) &gt; <span class="variable language_">this</span>.<span class="property">maxMoveSpeed</span>) &#123;</span><br><span class="line">            <span class="comment">// if speed reach limit, use max speed with current direction</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">xSpeed</span> = <span class="variable language_">this</span>.<span class="property">maxMoveSpeed</span> * <span class="variable language_">this</span>.<span class="property">xSpeed</span> / <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">xSpeed</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>&lt;-<span class="number">880</span>)&#123;</span><br><span class="line">            <span class="comment">//this.xSpeed=-this.xSpeed</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">xSpeed</span>=<span class="number">20</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>&gt;<span class="number">880</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">xSpeed</span>=-<span class="number">20</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据当前速度更新主角的位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">xSpeed</span> * dt</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onDestroy</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 取消键盘输入监听</span></span><br><span class="line">        cc.<span class="property">systemEvent</span>.<span class="title function_">off</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_DOWN</span>, <span class="variable language_">this</span>.<span class="property">onKeyDown</span>, <span class="variable language_">this</span>)</span><br><span class="line">        cc.<span class="property">systemEvent</span>.<span class="title function_">off</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_UP</span>, <span class="variable language_">this</span>.<span class="property">onKeyUp</span>, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="pickstars-4"><figure class="highlight ts"><figcaption><span>用于实现菜单控制及管理全局变量</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Global</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="attr">isRestart</span>:<span class="built_in">boolean</span>=<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span>  <span class="keyword">class</span> <span class="title class_">Start</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="title function_">playGame</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">parent</span>.<span class="title function_">destroy</span>()  </span><br><span class="line">        cc.<span class="property">director</span>.<span class="title function_">loadScene</span>(<span class="string">&quot;game&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    onLoad () &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Global</span>.<span class="property">isRestart</span>)&#123;</span><br><span class="line">            <span class="comment">//cc.find(&quot;Canvas/startButton/Background/start&quot;).getComponent(cc.Label).string=&quot;重新开始&quot;</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getChildByName</span>(<span class="string">&quot;Background&quot;</span>).<span class="title function_">getChildByName</span>(<span class="string">&quot;start&quot;</span>).<span class="title function_">getComponent</span>(cc.<span class="property">Label</span>).<span class="property">string</span>=<span class="string">&quot;重新开始&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// this.node.on(&#x27;mousedown&#x27;,this.playGame,this)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="string">&quot;touchstart&quot;</span>,<span class="variable language_">this</span>.<span class="property">playGame</span>,<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    start () &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// update (dt) &#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<h3 id="五子棋-GoBang"><a href="#五子棋-GoBang" class="headerlink" title="五子棋(GoBang)"></a>五子棋(GoBang)</h3><h4 id="GoBang"><a href="#GoBang" class="headerlink" title="GoBang"></a>GoBang</h4><p><a href="https://cmwlvip.github.io/game/GoBang/index.html">游戏预览</a><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">——Canvas</span><br><span class="line">    ——Main Camera</span><br><span class="line">    ——chess(Anchor:(0,0))</span><br><span class="line">    ——btn_start</span><br><span class="line">        ——title</span><br></pre></td></tr></table></figure></p>
<details class="toggle"><summary class="toggle-button" style>display</summary><div class="toggle-content"><figure class="highlight ts"><figcaption><span>挂载于棋盘节点</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">ChessBoard</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="comment">//使用棋子预制体</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">chessPrefab_black</span>:cc.<span class="property">Prefab</span>=<span class="literal">null</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">chessPrefab_white</span>:cc.<span class="property">Prefab</span>=<span class="literal">null</span></span><br><span class="line">    <span class="comment">//重新开始图片</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">SpriteFrame</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">restart</span>:cc.<span class="property">SpriteFrame</span>=<span class="literal">null</span></span><br><span class="line">    <span class="comment">//游戏结算面板</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">start_board</span>:cc.<span class="property">Prefab</span>=<span class="literal">null</span></span><br><span class="line">    <span class="comment">//边界落子提示面板</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Tip</span><span class="attr">_board</span>:cc.<span class="property">Prefab</span>=<span class="literal">null</span></span><br><span class="line">    <span class="comment">//开始节点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">startGame</span>:cc.<span class="property">Node</span>=<span class="literal">null</span></span><br><span class="line">    <span class="comment">//用于计数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">num</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//保存实例化之后的，不是0的值，0表示没有棋子，1黑棋，2白棋</span></span><br><span class="line">    <span class="keyword">private</span> _board=[]</span><br><span class="line">    <span class="comment">//戏是否进行游</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">isPlayGame</span>:<span class="built_in">boolean</span>=<span class="literal">false</span></span><br><span class="line">    <span class="comment">//是否重新开始</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">isRestart</span>:<span class="built_in">boolean</span>=<span class="literal">false</span></span><br><span class="line">    <span class="comment">//有18根线，设置21用于处理边界问题</span></span><br><span class="line">    <span class="title function_">initBoard</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">18</span>;i++)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_board</span>[i]=[]</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;<span class="number">18</span>;j++)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_board</span>[i][j]=<span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">playGame</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">isRestart</span>)&#123;</span><br><span class="line">            cc.<span class="property">director</span>.<span class="title function_">loadScene</span>(<span class="string">&quot;game&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">startGame</span>.<span class="property">active</span>=<span class="literal">false</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isPlayGame</span>=<span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">restartGame</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">startGame</span>.<span class="property">active</span>=<span class="literal">true</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">startGame</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="variable language_">this</span>.<span class="property">restart</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">startGame</span>.<span class="title function_">removeAllChildren</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">startGame</span>.<span class="property">scale</span>=<span class="number">0.5</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">startGame</span>.<span class="property">opacity</span>=<span class="number">200</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isRestart</span>=<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//是否可以下</span></span><br><span class="line">    <span class="title function_">isPlayChess</span>(<span class="params">i:<span class="built_in">number</span>,j:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[i][j]!=<span class="number">0</span>)&#123;</span><br><span class="line">            cc.<span class="title function_">log</span>(<span class="string">&quot;此处已有棋子&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 边界不落子提示</span></span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">0</span> || j==<span class="number">0</span> || i==<span class="number">17</span> || j==<span class="number">17</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="attr">tip</span>:cc.<span class="property">Node</span> = cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">Tip_board</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">addChild</span>(tip)</span><br><span class="line">            tip.<span class="title function_">setPosition</span>(cc.<span class="title function_">v2</span>(<span class="number">425</span>,<span class="number">500</span>))</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                tip.<span class="title function_">destroy</span>()</span><br><span class="line">              &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="number">500</span>)</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setNewChess</span>(<span class="params">event</span>)&#123;</span><br><span class="line">        cc.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">isPlayGame</span>)</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">isPlayGame</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">startPoint</span>:cc.<span class="property">Vec2</span> = event.<span class="title function_">getLocation</span>()</span><br><span class="line">        <span class="comment">//转换后的坐标，局部坐标</span></span><br><span class="line">        <span class="keyword">let</span> temp_position=<span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">convertToNodeSpaceAR</span>(startPoint)</span><br><span class="line">        <span class="keyword">let</span> x=<span class="title class_">Math</span>.<span class="title function_">round</span>(temp_position.<span class="property">x</span>/<span class="number">50</span>)</span><br><span class="line">        <span class="keyword">let</span> y=<span class="title class_">Math</span>.<span class="title function_">round</span>(temp_position.<span class="property">y</span>/<span class="number">50</span>)</span><br><span class="line">        <span class="comment">//确保棋子下在线上</span></span><br><span class="line">        <span class="keyword">let</span> <span class="attr">position</span>:cc.<span class="property">Vec2</span>=cc.<span class="title function_">v2</span>(x*<span class="number">50</span>,y*<span class="number">50</span>)  </span><br><span class="line">        <span class="comment">//记录转换坐标（索引）整体加一解决数组越界问题</span></span><br><span class="line">        <span class="comment">//现在边界不落子就不用处理越界，如左下角[0][0]是不下棋的，flag===0</span></span><br><span class="line">        <span class="keyword">let</span> myPos=cc.<span class="title function_">v2</span>(x,y)</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">num</span>%<span class="number">2</span>==<span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">isPlayChess</span>(myPos.<span class="property">x</span>,myPos.<span class="property">y</span>))&#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="attr">newChess_black</span>:cc.<span class="property">Node</span> = cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">chessPrefab_black</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">addChild</span>(newChess_black)</span><br><span class="line">            newChess_black.<span class="title function_">setPosition</span>(position)  </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>]=<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">judge</span>(<span class="number">1</span>,myPos))&#123;</span><br><span class="line">                cc.<span class="title function_">log</span>(<span class="string">&quot;黑胜&quot;</span>)</span><br><span class="line">                <span class="keyword">let</span> <span class="attr">newGame</span>:cc.<span class="property">Node</span> = cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">start_board</span>)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">addChild</span>(newGame)</span><br><span class="line">                newGame.<span class="property">children</span>[<span class="number">1</span>].<span class="property">color</span>=cc.<span class="property">Color</span>.<span class="property">BLACK</span></span><br><span class="line">                <span class="comment">//设置面板位置</span></span><br><span class="line">                newGame.<span class="title function_">setPosition</span>(cc.<span class="title function_">v2</span>(<span class="number">425</span>,<span class="number">325</span>))</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">restartGame</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">num</span>+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">num</span>%<span class="number">2</span>==<span class="number">1</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">isPlayChess</span>(myPos.<span class="property">x</span>,myPos.<span class="property">y</span>))&#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="attr">newChess_white</span>:cc.<span class="property">Node</span> = cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">chessPrefab_white</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">addChild</span>(newChess_white)</span><br><span class="line">            newChess_white.<span class="title function_">setPosition</span>(position)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>]=<span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">judge</span>(<span class="number">2</span>,myPos))&#123;</span><br><span class="line">                cc.<span class="title function_">log</span>(<span class="string">&quot;白胜&quot;</span>)</span><br><span class="line">                <span class="keyword">let</span> <span class="attr">newGame</span>:cc.<span class="property">Node</span> = cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">start_board</span>)</span><br><span class="line">                newGame.<span class="property">children</span>[<span class="number">1</span>].<span class="title function_">getComponent</span>(cc.<span class="property">Label</span>).<span class="property">string</span>=<span class="string">&quot;白棋&quot;</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">addChild</span>(newGame)</span><br><span class="line">                newGame.<span class="title function_">setPosition</span>(cc.<span class="title function_">v2</span>(<span class="number">425</span>,<span class="number">325</span>))</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">restartGame</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">num</span>+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断函数，用于判读输赢</span></span><br><span class="line">    <span class="title function_">judge</span>(<span class="params">flag:<span class="built_in">number</span>,myPos:cc.Vec2</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">judge_row</span>(flag,myPos) || <span class="variable language_">this</span>.<span class="title function_">judge_list</span>(flag,myPos) || <span class="variable language_">this</span>.<span class="title function_">judge_left</span>(flag,myPos) || <span class="variable language_">this</span>.<span class="title function_">judge_right</span>(flag,myPos))&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isPlayGame</span>=<span class="literal">false</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//判断横向</span></span><br><span class="line">    <span class="title function_">judge_row</span>(<span class="params">flag:<span class="built_in">number</span>,myPos:cc.Vec2</span>)&#123;</span><br><span class="line">        <span class="comment">//用于计数</span></span><br><span class="line">        <span class="keyword">let</span> count=<span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> i=<span class="number">1</span></span><br><span class="line">        <span class="comment">//右界已处理</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>+i][myPos.<span class="property">y</span>]==flag)&#123;</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        i=<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>-i][myPos.<span class="property">y</span>]==flag)&#123;</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count&lt;<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断纵向</span></span><br><span class="line">    <span class="title function_">judge_list</span>(<span class="params">flag:<span class="built_in">number</span>,myPos:cc.Vec2</span>)&#123;</span><br><span class="line">        <span class="comment">//用于计数</span></span><br><span class="line">        <span class="keyword">let</span> count=<span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> i=<span class="number">1</span></span><br><span class="line">        <span class="comment">//上界已处理</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>+i]==flag)&#123;</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        i=<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>-i]==flag)&#123;</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count&lt;<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//[0][0] [1][1] [2][2]</span></span><br><span class="line">    <span class="title function_">judge_left</span>(<span class="params">flag:<span class="built_in">number</span>,myPos:cc.Vec2</span>)&#123;</span><br><span class="line">        <span class="comment">//用于计数</span></span><br><span class="line">        <span class="keyword">let</span> count=<span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> i=<span class="number">1</span></span><br><span class="line">        <span class="comment">//右上脚已经处理</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>+i][myPos.<span class="property">y</span>+i]==flag)&#123;</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        i=<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>-i][myPos.<span class="property">y</span>-i]==flag)&#123;</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count&lt;<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">judge_right</span>(<span class="params">flag:<span class="built_in">number</span>,myPos:cc.Vec2</span>)&#123;</span><br><span class="line">        <span class="comment">//用于计数</span></span><br><span class="line">        <span class="keyword">let</span> count=<span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> i=<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>-i][myPos.<span class="property">y</span>+i]==flag)&#123;</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">        &#125; </span><br><span class="line">        i=<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">_board</span>[myPos.<span class="property">x</span>+i][myPos.<span class="property">y</span>-i]==flag)&#123;</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count&lt;<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    onLoad () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">startGame</span>=cc.<span class="title function_">find</span>(<span class="string">&quot;Canvas/btn_start&quot;</span>)</span><br><span class="line">        <span class="comment">// this.node.on(&#x27;mousedown&#x27;,this.setNewChess,this)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="string">&quot;touchstart&quot;</span>,<span class="variable language_">this</span>.<span class="property">setNewChess</span>, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    start () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initBoard</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// update (dt) &#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></details>
<h3 id="简易消消乐-Xiaoxiaole"><a href="#简易消消乐-Xiaoxiaole" class="headerlink" title="简易消消乐(Xiaoxiaole)"></a>简易消消乐(Xiaoxiaole)</h3><h4 id="Xiaoxiaole"><a href="#Xiaoxiaole" class="headerlink" title="Xiaoxiaole"></a>Xiaoxiaole</h4><p><a href="https://cmwlvip.github.io/game/Xiaoxiaole/index.html">游戏预览</a><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">——Canvas</span><br><span class="line">    ——Main Camera</span><br><span class="line">    ——bg(Anchor:(0,0))</span><br></pre></td></tr></table></figure></p>
<h4 id="Xiaoxiaole思路"><a href="#Xiaoxiaole思路" class="headerlink" title="Xiaoxiaole思路"></a>Xiaoxiaole思路</h4><p>就是一个递归的思想在里面</p>
<h4 id="Xiaoxiaole实现"><a href="#Xiaoxiaole实现" class="headerlink" title="Xiaoxiaole实现"></a>Xiaoxiaole实现</h4><div class="tabs" id="xiaoxiaole"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#xiaoxiaole-1">NewBlock.ts</button></li><li class="tab"><button type="button" data-href="#xiaoxiaole-2">Game.ts</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="xiaoxiaole-1"><figure class="highlight ts"><figcaption><span>挂载在一个方块预制体上</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="keyword">const</span> picArr=cc.<span class="title class_">Class</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;pic_List&quot;</span>,</span><br><span class="line">    <span class="attr">properties</span>:&#123;</span><br><span class="line">        <span class="attr">a</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">b</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">c</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">d</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">e</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">f</span>:&#123;</span><br><span class="line">            <span class="attr">default</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">type</span>:cc.<span class="property">SpriteFrame</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">NewBlock</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="meta">@property</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>:picArr,</span><br><span class="line">        <span class="attr">displayName</span>:<span class="string">&quot;图片数组&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    pic_List=<span class="literal">null</span>;</span><br><span class="line">    index=<span class="variable language_">this</span>.<span class="title function_">myRandom</span>(<span class="number">0</span>,<span class="number">5</span>)     </span><br><span class="line">    arr=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>]</span><br><span class="line">    <span class="title function_">xiaoxiaole</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">index</span>=<span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">myRandom</span>(<span class="params">min:<span class="built_in">number</span>,max:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="comment">//向下取整</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*(max-min+<span class="number">1</span>)+min)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">random_block</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">index</span>=<span class="variable language_">this</span>.<span class="title function_">myRandom</span>(<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">judge_block</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">index</span>]==<span class="string">&#x27;a&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="variable language_">this</span>.<span class="property">pic_List</span>.<span class="property">a</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">index</span>]==<span class="string">&#x27;b&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="variable language_">this</span>.<span class="property">pic_List</span>.<span class="property">b</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">index</span>]==<span class="string">&#x27;c&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="variable language_">this</span>.<span class="property">pic_List</span>.<span class="property">c</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">index</span>]==<span class="string">&#x27;d&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="variable language_">this</span>.<span class="property">pic_List</span>.<span class="property">d</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">index</span>]==<span class="string">&#x27;e&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="variable language_">this</span>.<span class="property">pic_List</span>.<span class="property">e</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">index</span>]==<span class="string">&#x27;f&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="variable language_">this</span>.<span class="property">pic_List</span>.<span class="property">f</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">index</span>]==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// onLoad () &#123; &#125;</span></span><br><span class="line">    <span class="comment">// start () &#123; &#125;</span></span><br><span class="line">    update (dt) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">judge_block</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="xiaoxiaole-2"><figure class="highlight ts"><figcaption><span>挂载在背景节点下控制游戏进行</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">NewClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Prefab</span>)</span><br><span class="line">    <span class="attr">pic</span>:cc.<span class="property">Prefab</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> arr=[];</span><br><span class="line">    <span class="title function_">xiaoxiaole</span>(<span class="params">event</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">Point</span>:cc.<span class="property">Vec2</span> = event.<span class="title function_">getLocation</span>()</span><br><span class="line">        <span class="comment">//转换后的坐标，局部坐标</span></span><br><span class="line">        <span class="keyword">let</span> temp_position=<span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">convertToNodeSpaceAR</span>(<span class="title class_">Point</span>)</span><br><span class="line">        <span class="keyword">let</span> x=<span class="title class_">Math</span>.<span class="title function_">round</span>((temp_position.<span class="property">x</span>+<span class="number">25</span>)/<span class="number">50</span>)</span><br><span class="line">        <span class="keyword">let</span> y=<span class="title class_">Math</span>.<span class="title function_">round</span>((temp_position.<span class="property">y</span>+<span class="number">25</span>)/<span class="number">50</span>)</span><br><span class="line">        <span class="comment">//左下角为(1,1)</span></span><br><span class="line">        <span class="keyword">let</span> myPos=cc.<span class="title function_">v2</span>(x,y)</span><br><span class="line">        <span class="comment">// cc.log(myPos.x,myPos.y)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">judge</span>(myPos)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">1</span>;i&lt;<span class="number">11</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">1</span>;j&lt;<span class="number">11</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[i][j]==<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">let</span> <span class="attr">n</span>:<span class="built_in">number</span>=<span class="number">1</span></span><br><span class="line">                    <span class="keyword">let</span> <span class="attr">a</span>:<span class="built_in">number</span>=<span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[i][j+a]==<span class="literal">null</span> &amp;&amp; j+a&lt;<span class="number">11</span>)&#123;</span><br><span class="line">                        <span class="comment">//记录空格</span></span><br><span class="line">                        n++</span><br><span class="line">                        a++</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// cc.log(n) </span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">let</span> k=<span class="number">0</span>;k&lt;(<span class="number">11</span>-n-j);k++)&#123;</span><br><span class="line">                            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(i-<span class="number">1</span>)*<span class="number">10</span>+j-<span class="number">1</span>+k].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="property">index</span></span><br><span class="line">                            =<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(i-<span class="number">1</span>)*<span class="number">10</span>+j-<span class="number">1</span>+k+n].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="property">index</span></span><br><span class="line">                            <span class="variable language_">this</span>.<span class="property">arr</span>[i][j+k]=<span class="variable language_">this</span>.<span class="property">arr</span>[i][j+k+n]</span><br><span class="line">                            <span class="variable language_">this</span>.<span class="property">arr</span>[i][j+k+n]=<span class="literal">null</span></span><br><span class="line">                            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(i-<span class="number">1</span>)*<span class="number">10</span>+j-<span class="number">1</span>+k+n].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="property">index</span>=<span class="literal">null</span></span><br><span class="line">                        &#125; </span><br><span class="line">                    &#125;, <span class="number">0.4</span>); </span><br><span class="line">                    <span class="comment">//放开此处break不生成新图片            </span></span><br><span class="line">                    <span class="comment">// break</span></span><br><span class="line">                    <span class="comment">//上面生成新图片</span></span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">let</span> k=<span class="number">0</span>;k&lt;n;k++)&#123;</span><br><span class="line">                            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(i-<span class="number">1</span>)*<span class="number">10</span>+<span class="number">9</span>-k].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="title function_">random_block</span>()</span><br><span class="line">                            <span class="variable language_">this</span>.<span class="property">arr</span>[i][<span class="number">10</span>-k]=<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(i-<span class="number">1</span>)*<span class="number">10</span>+<span class="number">9</span>-k].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="property">index</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>),<span class="number">950</span>)    </span><br><span class="line">                    <span class="keyword">break</span>                </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">judge</span>(<span class="params">myPos:cc.Vec2</span>)&#123;</span><br><span class="line">        <span class="comment">//来个变量记住一开始的图片</span></span><br><span class="line">        <span class="keyword">let</span> temp= <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>]</span><br><span class="line">        <span class="comment">//减去1的表示点击的节点，处理数组越界整体加了一</span></span><br><span class="line">        <span class="comment">//this.node.children[(myPos.x-1)*10+myPos.y-1]找到对应孩子节点 执行其函数</span></span><br><span class="line">        <span class="keyword">if</span>(temp==<span class="literal">null</span> || (<span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>-<span class="number">1</span>][myPos.<span class="property">y</span>]!=temp &amp;&amp; <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>+<span class="number">1</span>][myPos.<span class="property">y</span>]!=temp</span><br><span class="line">            &amp;&amp; <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>-<span class="number">1</span>]!=temp &amp;&amp; <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>+<span class="number">1</span>]!=temp))&#123;</span><br><span class="line">                <span class="comment">//上面有一个都不成立</span></span><br><span class="line">                <span class="keyword">return</span>    </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(myPos.<span class="property">x</span>-<span class="number">1</span>)*<span class="number">10</span>+myPos.<span class="property">y</span>-<span class="number">1</span>].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="title function_">xiaoxiaole</span>()  </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>]=<span class="literal">null</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>-<span class="number">1</span>][myPos.<span class="property">y</span>]==temp)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(myPos.<span class="property">x</span>-<span class="number">2</span>)*<span class="number">10</span>+myPos.<span class="property">y</span>-<span class="number">1</span>].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="title function_">xiaoxiaole</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">judge</span>(cc.<span class="title function_">v2</span>(myPos.<span class="property">x</span>-<span class="number">1</span>,myPos.<span class="property">y</span>)) </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>-<span class="number">1</span>][myPos.<span class="property">y</span>]=<span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>+<span class="number">1</span>][myPos.<span class="property">y</span>]==temp)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[myPos.<span class="property">x</span>*<span class="number">10</span>+myPos.<span class="property">y</span>-<span class="number">1</span>].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="title function_">xiaoxiaole</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">judge</span>(cc.<span class="title function_">v2</span>(myPos.<span class="property">x</span>+<span class="number">1</span>,myPos.<span class="property">y</span>))  </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>+<span class="number">1</span>][myPos.<span class="property">y</span>]=<span class="literal">null</span>  </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>-<span class="number">1</span>]==temp)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(myPos.<span class="property">x</span>-<span class="number">1</span>)*<span class="number">10</span>+myPos.<span class="property">y</span>-<span class="number">2</span>].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="title function_">xiaoxiaole</span>()  </span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">judge</span>(cc.<span class="title function_">v2</span>(myPos.<span class="property">x</span>,myPos.<span class="property">y</span>-<span class="number">1</span>))   </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>-<span class="number">1</span>]=<span class="literal">null</span> </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>+<span class="number">1</span>]==temp)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>[(myPos.<span class="property">x</span>-<span class="number">1</span>)*<span class="number">10</span>+myPos.<span class="property">y</span>].<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="title function_">xiaoxiaole</span>() </span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">judge</span>(cc.<span class="title function_">v2</span>(myPos.<span class="property">x</span>,myPos.<span class="property">y</span>+<span class="number">1</span>))   </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">arr</span>[myPos.<span class="property">x</span>][myPos.<span class="property">y</span>+<span class="number">1</span>]=<span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    onLoad () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initGame</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="string">&quot;mousedown&quot;</span>,<span class="variable language_">this</span>.<span class="property">xiaoxiaole</span>,<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">initGame</span>(<span class="params"></span>)&#123;      </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">arr</span>[i]=[]</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;<span class="number">12</span>;j++)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">arr</span>[i][j]=<span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">1</span>;i&lt;<span class="number">11</span>;i++)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">arr</span>[i]=[]</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">1</span>;j&lt;<span class="number">11</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="attr">block</span>:cc.<span class="property">Node</span> = cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">pic</span>)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">addChild</span>(block)</span><br><span class="line">                <span class="comment">// cc.log(block.getComponent(&quot;NewBlock&quot;).index)</span></span><br><span class="line">                <span class="comment">// cc.log(block.name)</span></span><br><span class="line">                block.<span class="title function_">setPosition</span>(cc.<span class="title function_">v2</span>(<span class="number">50</span>*i-<span class="number">25</span>,<span class="number">50</span>*j-<span class="number">25</span>))</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">arr</span>[i][j]=block.<span class="title function_">getComponent</span>(<span class="string">&quot;NewBlock&quot;</span>).<span class="property">index</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// start () &#123;&#125;</span></span><br><span class="line">     update (dt) &#123;    </span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<h3 id="打砖块-Bricks"><a href="#打砖块-Bricks" class="headerlink" title="打砖块(Bricks)"></a>打砖块(Bricks)</h3><h4 id="Bricks"><a href="#Bricks" class="headerlink" title="Bricks"></a>Bricks</h4><p><a href="https://cmwlvip.github.io/game/Bricks/index.html">游戏预览</a><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">——Canvas</span><br><span class="line">    ——Main Camera</span><br><span class="line">    ——bg</span><br><span class="line">        ——ball</span><br><span class="line">        ——board</span><br><span class="line">    ——wall</span><br><span class="line">        ——left</span><br><span class="line">        ——right</span><br><span class="line">        ——top</span><br><span class="line">    ——menu</span><br><span class="line">        ——level</span><br><span class="line">        ——score</span><br><span class="line">    ——restart</span><br><span class="line">        ——tip</span><br></pre></td></tr></table></figure></p>
<h4 id="Bricks游戏思路"><a href="#Bricks游戏思路" class="headerlink" title="Bricks游戏思路"></a>Bricks游戏思路</h4><p>主要是处理砖块碰撞问题，由于小球打在砖块的不同位置效果是不一样的，因此需要设计好不同的碰撞区域，并进行标记<br><img src="/img/loading.gif" data-original="/2022/12/03/Cocos/2022-12-10-00-28-09.png" alt="砖块碰撞设计"></p>
<h4 id="Bricks实现"><a href="#Bricks实现" class="headerlink" title="Bricks实现"></a>Bricks实现</h4><div class="tabs" id="bricks"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#bricks-1">Brick.ts</button></li><li class="tab"><button type="button" data-href="#bricks-2">Game.ts</button></li><li class="tab"><button type="button" data-href="#bricks-3">Ball.ts</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="bricks-1"><figure class="highlight ts"><figcaption><span>挂载在砖块预制体上</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Brick</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    onLoad () &#123;</span><br><span class="line">        <span class="keyword">let</span> red=<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span></span><br><span class="line">        <span class="keyword">let</span> green =<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span></span><br><span class="line">        <span class="keyword">let</span> blue =<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span></span><br><span class="line">        <span class="keyword">let</span> color=cc.<span class="title function_">color</span>(red,green,blue)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">color</span>=color</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// start () &#123;&#125;</span></span><br><span class="line">    <span class="comment">// update (dt) &#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bricks-2"><figure class="highlight ts"><figcaption><span>挂载在背景节点上用于控制游戏进行</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Game</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Prefab</span>)</span><br><span class="line">    <span class="attr">brick</span>:cc.<span class="property">Prefab</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Node</span>)</span><br><span class="line">    <span class="attr">player</span>:cc.<span class="property">Node</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="title class_">Left</span>:<span class="built_in">boolean</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="title class_">Right</span>:<span class="built_in">boolean</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="attr">xSpeed</span>:<span class="built_in">number</span>=<span class="number">11</span>;</span><br><span class="line">    <span class="title function_">initGame</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;<span class="number">15</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="attr">node</span>:cc.<span class="property">Node</span>=cc.<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">brick</span>)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">addChild</span>(node)</span><br><span class="line">                node.<span class="title function_">setPosition</span>(cc.<span class="title function_">v2</span>(-<span class="number">480</span>+i*<span class="number">120</span>,<span class="number">800</span>-j*<span class="number">60</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    onKeyDown (<span class="attr">event</span>:cc.<span class="property">Event</span>.<span class="property">EventKeyboard</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(event.<span class="property">keyCode</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">a</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">Left</span> = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">d</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">Right</span> = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    onKeyUp (event) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(event.<span class="property">keyCode</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">a</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">Left</span> = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">d</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">Right</span> = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">move</span>(<span class="params">event</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> offset = event.<span class="title function_">getDelta</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span> += offset.<span class="property">x</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>&lt;-<span class="number">450</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>=-<span class="number">445</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>&gt;<span class="number">450</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>=<span class="number">445</span></span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">    onLoad () &#123;</span><br><span class="line">        cc.<span class="property">systemEvent</span>.<span class="title function_">on</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_DOWN</span>, <span class="variable language_">this</span>.<span class="property">onKeyDown</span>, <span class="variable language_">this</span>)</span><br><span class="line">        cc.<span class="property">systemEvent</span>.<span class="title function_">on</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_UP</span>, <span class="variable language_">this</span>.<span class="property">onKeyUp</span>, <span class="variable language_">this</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(cc.<span class="property">Node</span>.<span class="property">EventType</span>.<span class="property">TOUCH_MOVE</span>, <span class="variable language_">this</span>.<span class="property">move</span>,<span class="variable language_">this</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initGame</span>()</span><br><span class="line">        <span class="keyword">let</span> node=<span class="keyword">new</span> cc.<span class="title class_">Node</span>()</span><br><span class="line">        node.<span class="property">color</span>=cc.<span class="property">Color</span>.<span class="property">BLACK</span></span><br><span class="line">        <span class="keyword">let</span> label=node.<span class="title function_">addComponent</span>(cc.<span class="property">Label</span>)</span><br><span class="line">        label.<span class="property">string</span>=<span class="string">&quot;调整球位置后\n按下空格(或者点击小球)\n开始消除砖块&quot;</span></span><br><span class="line">        label.<span class="property">fontSize</span>=<span class="number">70</span></span><br><span class="line">        label.<span class="property">lineHeight</span>=<span class="number">70</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">parent</span>.<span class="title function_">addChild</span>(node)</span><br><span class="line">        node.<span class="title function_">setPosition</span>(<span class="number">0</span>,-<span class="number">200</span>)</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            node.<span class="title function_">destroy</span>()</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// start () &#123;&#125;</span></span><br><span class="line">    update (dt) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">Left</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>-= dt*<span class="variable language_">this</span>.<span class="property">xSpeed</span>*<span class="number">100</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">Right</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>+=dt*<span class="variable language_">this</span>.<span class="property">xSpeed</span>*<span class="number">100</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>&lt;-<span class="number">450</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>=-<span class="number">445</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>&gt;<span class="number">450</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">player</span>.<span class="property">x</span>=<span class="number">445</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="bricks-3"><figure class="highlight ts"><figcaption><span>挂载在小球上实现碰撞</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">NewClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="comment">//通关提示</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">SpriteFrame</span>)</span><br><span class="line">    <span class="attr">win</span>:cc.<span class="property">SpriteFrame</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//得分面板</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Node</span>)</span><br><span class="line">    <span class="attr">scoreBoard</span>:cc.<span class="property">Node</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//等级面板</span></span><br><span class="line">    <span class="meta">@property</span>(cc.<span class="property">Node</span>)</span><br><span class="line">    <span class="attr">levelBoard</span>:cc.<span class="property">Node</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//重新开始面板</span></span><br><span class="line">    <span class="attr">restart</span>:cc.<span class="property">Node</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="attr">xSpeed</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="attr">ySpeed</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="attr">score</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="attr">level</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="attr">gameLevel</span>:<span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="attr">isLunch</span>:<span class="built_in">boolean</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="title function_">judge</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">tempNode</span>:cc.<span class="property">Node</span>=cc.<span class="title function_">find</span>(<span class="string">&quot;Canvas/bg&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;tempNode.<span class="property">children</span>.<span class="property">length</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tempNode.<span class="property">children</span>[i].<span class="property">name</span>==<span class="string">&quot;brick&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">restartGame</span>(<span class="params"></span>)&#123;</span><br><span class="line">        cc.<span class="property">director</span>.<span class="title function_">loadScene</span>(<span class="string">&quot;game&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">fire</span>(<span class="params">event</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(event.<span class="property">keyCode</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> cc.<span class="property">macro</span>.<span class="property">KEY</span>.<span class="property">space</span>:</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isLunch</span>=<span class="literal">true</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">changeLevel</span>()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeLevel</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">score</span>&gt;=<span class="variable language_">this</span>.<span class="property">level</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">level</span>+=<span class="number">10</span>+<span class="variable language_">this</span>.<span class="property">gameLevel</span>*<span class="number">10</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameLevel</span>+=<span class="number">1</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">levelBoard</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Label</span>).<span class="property">string</span>=<span class="string">&quot;等级：&quot;</span> + <span class="variable language_">this</span>.<span class="property">gameLevel</span>.<span class="title function_">toString</span>() </span><br><span class="line">            <span class="keyword">switch</span>(<span class="variable language_">this</span>.<span class="property">gameLevel</span>)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">xSpeed</span>=(<span class="variable language_">this</span>.<span class="property">xSpeed</span>&gt;=<span class="number">0</span>)?<span class="number">3</span>:-<span class="number">3</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ySpeed</span>=(<span class="variable language_">this</span>.<span class="property">ySpeed</span>&gt;=<span class="number">0</span>)?<span class="number">7</span>:-<span class="number">7</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">xSpeed</span>=(<span class="variable language_">this</span>.<span class="property">xSpeed</span>&gt;<span class="number">0</span>)?<span class="number">4</span>:-<span class="number">4</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ySpeed</span>=(<span class="variable language_">this</span>.<span class="property">ySpeed</span>&gt;<span class="number">0</span>)?<span class="number">9</span>:-<span class="number">9</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">xSpeed</span>=(<span class="variable language_">this</span>.<span class="property">xSpeed</span>&gt;<span class="number">0</span>)?<span class="number">4</span>:-<span class="number">4</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ySpeed</span>=(<span class="variable language_">this</span>.<span class="property">ySpeed</span>&gt;<span class="number">0</span>)?<span class="number">10</span>:-<span class="number">10</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">xSpeed</span>=(<span class="variable language_">this</span>.<span class="property">xSpeed</span>&gt;<span class="number">0</span>)?<span class="number">5</span>:-<span class="number">5</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ySpeed</span>=(<span class="variable language_">this</span>.<span class="property">ySpeed</span>&gt;<span class="number">0</span>)?<span class="number">11</span>:-<span class="number">11</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">xSpeed</span>=(<span class="variable language_">this</span>.<span class="property">xSpeed</span>&gt;<span class="number">0</span>)?<span class="number">5</span>:-<span class="number">5</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ySpeed</span>=(<span class="variable language_">this</span>.<span class="property">ySpeed</span>&gt;<span class="number">0</span>)?<span class="number">13</span>:-<span class="number">13</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">xSpeed</span>=(<span class="variable language_">this</span>.<span class="property">xSpeed</span>&gt;<span class="number">0</span>)?<span class="number">6</span>:-<span class="number">6</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ySpeed</span>=(<span class="variable language_">this</span>.<span class="property">ySpeed</span>&gt;<span class="number">0</span>)?<span class="number">15</span>:-<span class="number">15</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">xSpeed</span>=(<span class="variable language_">this</span>.<span class="property">xSpeed</span>&gt;<span class="number">0</span>)?<span class="number">6</span>:-<span class="number">6</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ySpeed</span>=(<span class="variable language_">this</span>.<span class="property">ySpeed</span>&gt;<span class="number">0</span>)?<span class="number">17</span>:-<span class="number">17</span></span><br><span class="line">                <span class="attr">default</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    onLoad () &#123;</span><br><span class="line">        <span class="keyword">let</span> manager = cc.<span class="property">director</span>.<span class="title function_">getCollisionManager</span>()</span><br><span class="line">        manager.<span class="property">enabled</span>=<span class="literal">true</span></span><br><span class="line">        manager.<span class="property">enabledDebugDraw</span>=<span class="literal">true</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">restart</span>=cc.<span class="title function_">find</span>(<span class="string">&quot;Canvas/restart&quot;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">restart</span>.<span class="property">active</span>=<span class="literal">false</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">AudioSource</span>).<span class="property">preload</span>=<span class="literal">true</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="string">&quot;touchstart&quot;</span>,<span class="function">()=&gt;</span>&#123;<span class="variable language_">this</span>.<span class="property">isLunch</span>=<span class="literal">true</span>;<span class="variable language_">this</span>.<span class="title function_">changeLevel</span>()&#125;,<span class="variable language_">this</span>)</span><br><span class="line">        cc.<span class="property">systemEvent</span>.<span class="title function_">on</span>(cc.<span class="property">SystemEvent</span>.<span class="property">EventType</span>.<span class="property">KEY_DOWN</span>, <span class="variable language_">this</span>.<span class="property">fire</span>, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onCollisionEnter</span>(<span class="params">other,self:cc.PolygonCollider</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(other.<span class="property">tag</span>==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ySpeed</span>=-<span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">ySpeed</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(other.<span class="property">tag</span>==<span class="number">5</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ySpeed</span>=<span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">ySpeed</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(other.<span class="property">tag</span>==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">xSpeed</span>=-<span class="variable language_">this</span>.<span class="property">xSpeed</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(other.<span class="property">tag</span>==<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">xSpeed</span>=-<span class="variable language_">this</span>.<span class="property">xSpeed</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(other.<span class="property">tag</span>==<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ySpeed</span>=-<span class="variable language_">this</span>.<span class="property">ySpeed</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onCollisionExit</span>(<span class="params">other, self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(other.<span class="property">tag</span>==<span class="number">1</span> || other.<span class="property">tag</span>==<span class="number">2</span> || other.<span class="property">tag</span>==<span class="number">5</span>)&#123;</span><br><span class="line">            other.<span class="property">node</span>.<span class="title function_">destroy</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">score</span>+=<span class="number">1</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">scoreBoard</span>.<span class="title function_">getComponent</span>(cc.<span class="property">Label</span>).<span class="property">string</span>=<span class="string">&quot;得分：&quot;</span> + <span class="variable language_">this</span>.<span class="property">score</span>.<span class="title function_">toString</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">getComponent</span>(cc.<span class="property">AudioSource</span>).<span class="title function_">play</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">changeLevel</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// start () &#123;&#125;</span></span><br><span class="line">    update (dt) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">judge</span>())&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">restart</span>.<span class="title function_">getChildByName</span>(<span class="string">&quot;tip&quot;</span>).<span class="title function_">getComponent</span>(cc.<span class="property">Sprite</span>).<span class="property">spriteFrame</span>=<span class="variable language_">this</span>.<span class="property">win</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">restart</span>.<span class="property">active</span>=<span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>+=<span class="variable language_">this</span>.<span class="property">xSpeed</span>*dt*<span class="number">100</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">y</span>+=<span class="variable language_">this</span>.<span class="property">ySpeed</span>*dt*<span class="number">100</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">y</span>&lt;-<span class="number">960</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">restart</span>.<span class="property">active</span>=<span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">isLunch</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>=cc.<span class="title function_">find</span>(<span class="string">&quot;Canvas/bg/board&quot;</span>).<span class="property">x</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>&gt;<span class="number">530</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>=<span class="number">514</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>&lt;-<span class="number">530</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">x</span>=-<span class="number">514</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://cmwlvip.github.io">Shiqing Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://cmwlvip.github.io/2022/12/03/Cocos/">https://cmwlvip.github.io/2022/12/03/Cocos/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://cmwlvip.github.io" target="_blank">Ofra Serendipity</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cocos/">cocos</a></div><div class="post_share"><div class="social-share" data-image="/2022/12/03/Cocos/cocos.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-original="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-original="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/03/Git/"><img class="prev-cover" src="/img/loading.gif" data-original="/2022/12/03/Git/git.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Git</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/21/Butterfly/"><img class="next-cover" src="/img/loading.gif" data-original="https://pic.imgdb.cn/item/63f471fdf144a0100725e5dc.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Butterfly</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODA4MS8zNDU0NA=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/avatar001.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Shiqing Huang</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/cmwlvip"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/cmwlvip" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://gitee.com/cmwlvip" target="_blank" title="Gitee"><i class="fab fa-git"></i></a><a class="social-icon" href="mailto:2689050828@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Cocos-Creator"><span class="toc-number">1.</span> <span class="toc-text">使用Cocos Creator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.1.</span> <span class="toc-text">新建脚本模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cocos%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.</span> <span class="toc-text">Cocos项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-TS%E4%B8%8B-Cocos%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">关于(TS下)Cocos使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%EF%BC%9A%E6%97%A0%E6%B3%95%E9%87%8D%E6%96%B0%E5%A3%B0%E6%98%8E%E5%9D%97%E8%8C%83%E5%9B%B4%E5%8F%98%E9%87%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">报错：无法重新声明块范围变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%94%99%E8%AF%AF"><span class="toc-number">1.3.2.</span> <span class="toc-text">二维数组使用中错误</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cocos%E8%84%9A%E6%9C%AC%E5%BC%80%E5%8F%91"><span class="toc-number">2.</span> <span class="toc-text">Cocos脚本开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TS%E8%A1%A5%E5%85%85"><span class="toc-number">2.1.</span> <span class="toc-text">TS补充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%96%E6%95%B4"><span class="toc-number">2.1.1.</span> <span class="toc-text">取整</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%9D%E5%AF%B9%E5%80%BC"><span class="toc-number">2.1.2.</span> <span class="toc-text">绝对值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83"><span class="toc-number">2.1.3.</span> <span class="toc-text">回调</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setTimeout"><span class="toc-number">2.1.4.</span> <span class="toc-text">setTimeout()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E5%9D%97-%E4%BB%A3%E7%A0%81%E7%BB%84%E4%BB%B6%E5%8C%96"><span class="toc-number">2.2.</span> <span class="toc-text">常用代码块(代码组件化)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E9%A2%9C%E8%89%B2"><span class="toc-number">2.2.1.</span> <span class="toc-text">随机颜色</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E8%B5%84%E6%BA%90"><span class="toc-number">2.3.</span> <span class="toc-text">挂载资源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%82%E8%BD%BDCocos%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">挂载Cocos类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6"><span class="toc-number">2.4.</span> <span class="toc-text">组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6"><span class="toc-number">2.4.1.</span> <span class="toc-text">获取组件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%88%B6%E4%BD%93"><span class="toc-number">2.5.</span> <span class="toc-text">预制体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF"><span class="toc-number">2.6.</span> <span class="toc-text">场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E5%9C%BA%E6%99%AF"><span class="toc-number">2.6.1.</span> <span class="toc-text">切换场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9-cc-Node"><span class="toc-number">2.7.</span> <span class="toc-text">节点(cc.Node)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E7%BB%93%E7%82%B9"><span class="toc-number">2.7.1.</span> <span class="toc-text">新结点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E8%8A%82%E7%82%B9"><span class="toc-number">2.7.2.</span> <span class="toc-text">寻找节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E5%B1%82%E6%AC%A1"><span class="toc-number">2.7.3.</span> <span class="toc-text">节点层次</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E4%B8%8E%E8%B7%9D%E7%A6%BB"><span class="toc-number">2.8.</span> <span class="toc-text">坐标与距离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%9D%90%E6%A0%87%E8%BD%AC%E7%9B%B8%E5%AF%B9%E5%9D%90%E6%A0%87"><span class="toc-number">2.8.1.</span> <span class="toc-text">全局坐标转相对坐标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E5%87%8F%E6%B3%95"><span class="toc-number">2.8.2.</span> <span class="toc-text">向量减法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E9%95%BF%E5%BA%A6"><span class="toc-number">2.8.3.</span> <span class="toc-text">向量长度</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.9.</span> <span class="toc-text">鼠标事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.10.</span> <span class="toc-text">触摸事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E9%9F%B3"><span class="toc-number">2.11.</span> <span class="toc-text">声音</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E8%B5%84%E6%BA%90%E6%B3%95%E4%BD%BF%E7%94%A8%E5%A3%B0%E9%9F%B3-cc-AudioClip"><span class="toc-number">2.11.1.</span> <span class="toc-text">挂载资源法使用声音(cc.AudioClip)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6-cc-AudioSource-%E6%B3%95%E4%BD%BF%E7%94%A8%E5%A3%B0%E9%9F%B3"><span class="toc-number">2.11.2.</span> <span class="toc-text">组件(cc.AudioSource)法使用声音</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A2%B0%E6%92%9E%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.</span> <span class="toc-text">碰撞系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A2%B0%E6%92%9E%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.1.</span> <span class="toc-text">碰撞系统接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A2%B0%E6%92%9E%E7%BB%84%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">碰撞组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%A9%E5%BD%A2%E7%A2%B0%E6%92%9E%E7%BB%84%E4%BB%B6-cc-BoxCollider"><span class="toc-number">3.2.1.</span> <span class="toc-text">矩形碰撞组件(cc.BoxCollider)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%86%E5%BD%A2%E7%A2%B0%E6%92%9E%E7%BB%84%E4%BB%B6-cc-CircleCollider"><span class="toc-number">3.2.2.</span> <span class="toc-text">圆形碰撞组件(cc.CircleCollider)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%A2%B0%E6%92%9E%E7%BB%84%E4%BB%B6-cc-PolygonCollider"><span class="toc-number">3.2.3.</span> <span class="toc-text">多边形碰撞组件(cc.PolygonCollider)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A2%B0%E6%92%9E%E7%B3%BB%E7%BB%9F%E5%9B%9E%E8%B0%83"><span class="toc-number">3.3.</span> <span class="toc-text">碰撞系统回调</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A2%B0%E6%92%9E%E4%BA%A7%E7%94%9F%E7%9A%84%E6%97%B6%E5%80%99%E8%B0%83%E7%94%A8"><span class="toc-number">3.3.1.</span> <span class="toc-text">碰撞产生的时候调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A2%B0%E6%92%9E%E4%B8%AD%E8%B0%83%E7%94%A8"><span class="toc-number">3.3.2.</span> <span class="toc-text">碰撞中调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A2%B0%E6%92%9E%E7%BB%93%E6%9D%9F%E5%90%8E%E8%B0%83%E7%94%A8"><span class="toc-number">3.3.3.</span> <span class="toc-text">碰撞结束后调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E7%A7%BB%E5%8A%A8"><span class="toc-number">4.</span> <span class="toc-text">角色移动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E4%BA%8B%E4%BB%B6%E6%8E%A7%E5%88%B6%E7%A7%BB%E5%8A%A8"><span class="toc-number">4.1.</span> <span class="toc-text">键盘事件控制移动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E9%80%9F%E5%BA%A6%E5%BC%8F%E7%A7%BB%E5%8A%A8"><span class="toc-number">4.2.</span> <span class="toc-text">加速度式移动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E6%91%B8%E7%A7%BB%E5%8A%A8"><span class="toc-number">4.3.</span> <span class="toc-text">触摸移动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cocos-Project"><span class="toc-number">5.</span> <span class="toc-text">Cocos Project</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%91%98%E6%98%9F%E6%98%9F-PickStars"><span class="toc-number">5.1.</span> <span class="toc-text">摘星星(PickStars)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PickStars"><span class="toc-number">5.1.1.</span> <span class="toc-text">PickStars</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E5%AD%90%E6%A3%8B-GoBang"><span class="toc-number">5.2.</span> <span class="toc-text">五子棋(GoBang)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GoBang"><span class="toc-number">5.2.1.</span> <span class="toc-text">GoBang</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E6%98%93%E6%B6%88%E6%B6%88%E4%B9%90-Xiaoxiaole"><span class="toc-number">5.3.</span> <span class="toc-text">简易消消乐(Xiaoxiaole)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Xiaoxiaole"><span class="toc-number">5.3.1.</span> <span class="toc-text">Xiaoxiaole</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Xiaoxiaole%E6%80%9D%E8%B7%AF"><span class="toc-number">5.3.2.</span> <span class="toc-text">Xiaoxiaole思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Xiaoxiaole%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.3.3.</span> <span class="toc-text">Xiaoxiaole实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E7%A0%96%E5%9D%97-Bricks"><span class="toc-number">5.4.</span> <span class="toc-text">打砖块(Bricks)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Bricks"><span class="toc-number">5.4.1.</span> <span class="toc-text">Bricks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bricks%E6%B8%B8%E6%88%8F%E6%80%9D%E8%B7%AF"><span class="toc-number">5.4.2.</span> <span class="toc-text">Bricks游戏思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bricks%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.4.3.</span> <span class="toc-text">Bricks实现</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/02/23/hexo-plugins/" title="hexo-plugins"><img src="/img/loading.gif" data-original="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo-plugins"/></a><div class="content"><a class="title" href="/2023/02/23/hexo-plugins/" title="hexo-plugins">hexo-plugins</a><time datetime="2023-02-23T04:22:55.000Z" title="发表于 2023-02-23 12:22:55">2023-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/21/Butterfly/" title="Butterfly"><img src="/img/loading.gif" data-original="https://pic.imgdb.cn/item/63f471fdf144a0100725e5dc.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Butterfly"/></a><div class="content"><a class="title" href="/2023/02/21/Butterfly/" title="Butterfly">Butterfly</a><time datetime="2023-02-21T07:11:10.000Z" title="发表于 2023-02-21 15:11:10">2023-02-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/03/Cocos/" title="Cocos"><img src="/img/loading.gif" data-original="/2022/12/03/Cocos/cocos.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cocos"/></a><div class="content"><a class="title" href="/2022/12/03/Cocos/" title="Cocos">Cocos</a><time datetime="2022-12-03T14:46:46.000Z" title="发表于 2022-12-03 22:46:46">2022-12-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/03/Git/" title="Git"><img src="/img/loading.gif" data-original="/2022/12/03/Git/git.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git"/></a><div class="content"><a class="title" href="/2022/12/03/Git/" title="Git">Git</a><time datetime="2022-12-03T04:10:02.000Z" title="发表于 2022-12-03 12:10:02">2022-12-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/25/CSharp/" title="C#"><img src="/img/loading.gif" data-original="/2022/11/25/CSharp/CSharp.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C#"/></a><div class="content"><a class="title" href="/2022/11/25/CSharp/" title="C#">C#</a><time datetime="2022-11-24T16:22:35.000Z" title="发表于 2022-11-25 00:22:35">2022-11-25</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://pic.imgdb.cn/item/638b68b716f2c2beb14d07d1.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Shiqing Huang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/movies/"]):not([href="/books/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: true,
                preloadRatio: 3,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>